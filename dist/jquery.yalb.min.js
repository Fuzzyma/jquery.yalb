/*! Yalb - v0.1.0 - 2015-02-10
* https://github.com/Fuzzyma/jquery.yalb
* Copyright (c) 2015 Ulrich-Matthias Sch√§fer; Licensed MIT */
!function(a){var b=null;a.yalb=function(c){if(!(this instanceof a.yalb))return b&&b.yalb.trigger("close"),new a.yalb(c);b=this;var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u=a.extend({},a.yalb.defaults,c),v=[],w=u.imgs,x=u.current,y=a("<div>"),z=0,A=0;e=function(b){return a("<span>",{"class":b,click:function(){y.trigger(b)}})},y.addClass(u["class"]).append(e("prev")).append(e("next")).append(e("close")).append(a("<span>").addClass("loader").hide()).append(a("<strong>").addClass("error").hide()),d=a("<div>").addClass(u["class"]+"_wrapper").click(function(a){a.target===this&&y.trigger("close")}).append(y),k=function(a){return function(){v[a].loaded=!0,a===x&&m()}},l=function(a){return function(){v[a].error=!0,a===x&&m()}},m=function(){t(),v[x].loaded?p():v[x].error?q():(r(),n())},n=function(a){a=a||[x];for(var b=0,c=a.length;c>b;++b)a[b]>=v.length||a[b]<0||v[a[b]].loaded||v[a[b]].pending||v[a[b]].error||(v[a[b]].img.src=w[a[b]][u.src],v[a[b]].pending=!0)},r=function(){y.children("img.loader").stop().fadeIn()},s=function(){y.children("img.loader").stop().fadeOut(),y.children("strong.error").stop().fadeOut()},o=function(){y.append(a(v[x].img).addClass("image").fadeIn()),y.trigger("change",{index:x}),n([x-1,x+1])},q=function(){y.children("img.image").fadeOut(),y.children("strong.error").fadeIn(),n([x-1,x+1])},p=function(){s();var b=v[x].img.naturalWidth/v[x].img.naturalHeight,c=v[x].img.naturalHeight,d=v[x].img.naturalWidth;c>a(window).height()-40&&(c=a(window).height()-40,d=b*(a(window).height()-40)),d>a(window).width()-40&&(d=a(window).width()-40,c=(a(window).width()-40)/b),y.children("img.image").attr("src")!==a(v[x].img).attr("src")&&(y.children("img.image").length&&y.children("img.image").fadeOut(function(){a(this).remove()}),Math.abs(z-d)>1||Math.abs(A-c)>1?(y.stop(),y.animate({width:d,height:c,bottom:-(a(window).height()-c)/2},o)):o(),A=c,z=d)},t=function(){u.loop||(x===w.length-1?y.children(".next").hide():y.children(".next").show(),0===x?y.children(".prev").hide():y.children(".prev").show())},f=function(){x>0?(--x,m()):u.loop&&(x=v.length-1,m())},g=function(){x<w.length-1?(++x,m()):u.loop&&(x=0,m())},h=function(){y.parent().fadeOut(function(){a(this).remove()}),y.unbind()},j=function(a,b){null!==b.index&&(x=b.index%v.length,m())},i=function(){d.appendTo("body").fadeIn(),m()},y.on({prev:f,next:g,close:h,show:j,open:i}),this.yalb=y;for(var B=0,C=w.length;C>B;++B)v[B]={img:new Image,loaded:!1,pending:!1,error:!1},v[B].img.onload=function(a){return k(a)}(B),v[B].img.onerror=function(a){return l(a)}(B);u.open&&(i(),m())},a.yalb.prev=function(){b&&b.yalb.trigger("prev")},a.yalb.next=function(){b&&b.yalb.trigger("next")},a.yalb.close=function(){b&&b.yalb.trigger("close")},a.yalb.show=function(a){b&&b.yalb.trigger("show",{index:a})},a.yalb.open=function(){b&&b.yalb.trigger("open")},a.yalb.on=function(){b&&b.yalb.on.apply(b.yalb,Array.prototype.slice.call(arguments,0))},a.yalb.off=function(){b&&b.yalb.off.apply(b.yalb,Array.prototype.slice.call(arguments,0))},a.yalb.get=function(){return b?b.yalb:void 0},a.yalb.defaults={imgs:[],src:"src",current:0,"class":"yalb",loop:!0,open:!0}}(jQuery);