/*! jquery.yalb - v0.3.0 - 2015-02-13
* https://github.com/Fuzzyma/jquery.yalb
* Copyright (c) 2015 Ulrich-Matthias Sch√§fer; Licensed MIT */
!function(a){var b=null;a.yalb=function(c,d){if(!(this instanceof a.yalb))return b&&b.yalb.trigger("close"),new a.yalb(c,d);b=this;var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w=a.extend({},a.yalb.defaults,d),x=[],y=w.current,z=a("<div>");e=function(b){return a("<span>",{"class":b,click:function(){z.trigger(b)}})},z.addClass(w["class"]).append(e("prev")).append(e("next")).append(e("close")).append(a("<span>").addClass("loader").hide()).append(a("<strong>").addClass("error").hide()),v=a("<div>").addClass(w["class"]+"_wrapper").click(function(a){a.target===this&&z.trigger("close")}).append(z),l=function(a){return function(){x[a].loaded=!0,a===y&&n()}},m=function(a){return function(){x[a].error=!0,a===y&&n()}},n=function(){u(),x[y].loaded?q():x[y].error?r():(s(),o())},i=function(a){if("string"==typeof a)return a;if(a instanceof Node&&0===w.src.indexOf("data-"))return a.dataset[w.src.substr(5).split("-").map(function(a,b){return b?a.charAt(0).toUpperCase()+a.slice(1):a}).join("")];for(var b=w.src.split("."),c=0,d=b.length;d>c;++c)a=a[b[c]];return a},o=function(a){a=a||[y];for(var b=a.length;b--;)w.loop&&a[b]<0&&(a[b]+=x.length),a[b]>=x.length||a[b]<0||x[a[b]].loaded||x[a[b]].pending||x[a[b]].error||(x[a[b]].img.src=i(c[a[b]]),x[a[b]].pending=!0)},s=function(){z.children("span.loader").stop().fadeIn()},t=function(){z.children("span.loader").stop().fadeOut(),z.children("strong.error").stop().fadeOut()},p=function(){z.append(a(x[y].img).addClass("image").fadeIn()),z.trigger("change",{index:y}),o([y-1,y+1])},r=function(){z.children("img.image").fadeOut(function(){a(this).remove()}),z.children("span.loader").stop().fadeOut(),z.children("strong.error").fadeIn(),o([y-1,y+1])},q=function(){if(t(),z.children("img.image").attr("src")!==a(x[y].img).attr("src")){z.children("img.image").length&&z.children("img.image").fadeOut(function(){a(this).remove()});var b=x[y].img.naturalWidth/x[y].img.naturalHeight,c=x[y].img.naturalHeight,d=x[y].img.naturalWidth,e=w.height||a(window).height()-40,f=w.width||a(window).width()-40;c>e&&(c=e,d=b*e),d>f&&(d=f,c=f/b),Math.abs(z.width()-d)>1||Math.abs(z.height()-c)>1?(z.stop(),z.animate({width:d,height:c,bottom:-(a(window).height()-c)/2},p)):p()}},u=function(){w.loop&&c.length>1||(y===c.length-1?z.children(".next").hide():z.children(".next").show(),0===y?z.children(".prev").hide():z.children(".prev").show())},f=function(){y>0?(--y,n()):w.loop&&(y=x.length-1,n())},g=function(){y<c.length-1?(++y,n()):w.loop&&(y=0,n())},h=function(){z.parent().fadeOut(function(){a(this).remove()}),z.unbind()},k=function(a,b){null!==b.index&&(y=b.index%x.length,n())},j=function(){v.appendTo("body").fadeIn(),n()},z.on({prev:f,next:g,close:h,show:k,open:j}),this.yalb=z;for(var A=0,B=c.length;B>A;++A)x[A]={img:new Image,loaded:!1,pending:!1,error:!1},x[A].img.onload=l(A),x[A].img.onerror=m(A);w.open&&(j(),n())},a.yalb.prev=function(){b&&b.yalb.trigger("prev")},a.yalb.next=function(){b&&b.yalb.trigger("next")},a.yalb.close=function(){b&&b.yalb.trigger("close")},a.yalb.show=function(a){b&&b.yalb.trigger("show",{index:a})},a.yalb.open=function(){b&&b.yalb.trigger("open")},a.yalb.on=function(){b&&b.yalb.on.apply(b.yalb,Array.prototype.slice.call(arguments,0))},a.yalb.off=function(){b&&b.yalb.off.apply(b.yalb,Array.prototype.slice.call(arguments,0))},a.yalb.get=function(){return b?b.yalb:void 0},a.yalb.defaults={src:"src",current:0,"class":"yalb",loop:!0,open:!0,width:0,height:0},a.fn.yalb=function(b){return a.yalb(this,b),this}}(jQuery);